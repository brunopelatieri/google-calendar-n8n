{
  "name": "ü§ñ AGENTE ‚Äî AI Assistente de Agendamento",
  "nodes": [
    {
      "parameters": {
        "content": "## ü§ñ WORKFLOW DO AGENTE AI ‚Äî Assistente de Agendamento\n\n**PROP√ìSITO:** Agente conversacional que usa o Google Calendar\ncomo ferramenta para gerenciar agendamentos.\n\n**ARQUITETURA:**\n```\nUsu√°rio ‚Üí Webhook/Chat ‚Üí AI Agent ‚Üí Workflow Tool ‚Üí Google Calendar\n                                                  ‚Üí Supabase\n```\n\n**COMO FUNCIONA:**\n1. O usu√°rio envia uma mensagem (ex: \"Agende reuni√£o amanh√£ √†s 14h\")\n2. O AI Agent interpreta a inten√ß√£o e extrai os dados\n3. O agente chama a `Workflow Tool` com a action correta\n4. A tool executa no Google Calendar e retorna confirma√ß√£o\n5. O agente responde ao usu√°rio de forma natural\n\n**MODELO RECOMENDADO:** GPT-4o ou Claude 3.5 Sonnet\n(Modelos com melhor capacidade de function calling)",
        "height": 360,
        "width": 680,
        "color": 5
      },
      "id": "comment-agent-main",
      "name": "üìã Documenta√ß√£o do Agente",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [-300, -300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "agendamento-ai",
        "responseMode": "responseNode",
        "options": {
          "rawBody": false
        }
      },
      "id": "webhook-trigger",
      "name": "üåê Webhook ‚Äî Entrada",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [0, 0],
      "webhookId": "agendamento-ai-webhook"
    },
    {
      "parameters": {
        "content": "### üåê WEBHOOK DE ENTRADA\n**URL gerada pelo n8n:**\n`https://SEU_N8N/webhook/agendamento-ai`\n\n**Payload esperado (JSON):**\n```json\n{\n  \"message\": \"Agende uma reuni√£o amanh√£ √†s 14h\",\n  \"session_id\": \"user_123\",\n  \"user_name\": \"Jo√£o Silva\"\n}\n```\n\n**Alternativas de trigger:**\n- Chat Trigger (para interface embutida)\n- WhatsApp/Telegram via Evolution API\n- Formul√°rio n8n\n\n**‚ö†Ô∏è Para produ√ß√£o, adicione autentica√ß√£o\nno webhook (Header Auth ou Bearer Token)**",
        "height": 270,
        "width": 310,
        "color": 6
      },
      "id": "comment-webhook",
      "name": "Nota - Webhook",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [0, -300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "msg",
              "name": "user_message",
              "value": "={{ $json.body?.message ?? $json.message ?? $json.chatInput ?? '' }}",
              "type": "string"
            },
            {
              "id": "sess",
              "name": "session_id",
              "value": "={{ $json.body?.session_id ?? $json.session_id ?? 'default_session' }}",
              "type": "string"
            },
            {
              "id": "uname",
              "name": "user_name",
              "value": "={{ $json.body?.user_name ?? $json.user_name ?? 'Usu√°rio' }}",
              "type": "string"
            },
            {
              "id": "ts",
              "name": "timestamp",
              "value": "={{ new Date().toISOString() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "prepare-input",
      "name": "‚öôÔ∏è Preparar Input do Usu√°rio",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [240, 0]
    },
    {
      "parameters": {
        "content": "### ‚öôÔ∏è PREPARAR INPUT\nNormaliza o payload de entrada para garantir\ncompatibilidade com diferentes fontes\n(webhook, WhatsApp, Telegram, etc).\n\n`session_id` √© usado para manter\nmem√≥ria de conversa√ß√£o com o Buffer Memory.",
        "height": 160,
        "width": 270,
        "color": 7
      },
      "id": "comment-prepare",
      "name": "Nota - Preparar",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [240, -200]
    },
    {
      "parameters": {
        "agent": "conversationalAgent",
        "promptType": "define",
        "text": "={{ $json.user_message }}",
        "hasOutputParser": false,
        "options": {
          "systemMessage": "Voc√™ √© um assistente inteligente de agendamento. Seu nome √© **Agenda AI**.\n\nVoc√™ gerencia eventos no Google Calendar do usu√°rio.\nSempre seja cordial, claro e confirme as informa√ß√µes antes de agir.\n\n**REGRAS DE COMPORTAMENTO:**\n\n1. **CRIAR EVENTO:** Quando o usu√°rio pedir para agendar, marcar ou criar um evento:\n   - Extraia: t√≠tulo, data/hora de in√≠cio, data/hora de fim, descri√ß√£o (opcional), convidados (opcional)\n   - Se a hora de fim n√£o for mencionada, assuma 1 hora ap√≥s o in√≠cio\n   - Sempre confirme os dados extra√≠dos antes de criar\n   - Use action: `create`\n\n2. **LER EVENTO:** Quando o usu√°rio perguntar sobre um evento espec√≠fico:\n   - Solicite o `event_id` se n√£o tiver\n   - Use action: `read`\n\n3. **ATUALIZAR EVENTO:** Quando o usu√°rio quiser alterar um evento:\n   - Solicite o `event_id` do evento a ser atualizado\n   - Use action: `update` com os campos a modificar\n\n4. **DELETAR EVENTO:** Quando o usu√°rio quiser cancelar ou excluir:\n   - Sempre pe√ßa confirma√ß√£o expl√≠cita antes de deletar\n   - Use action: `delete`\n\n5. **LISTAR EVENTOS:** Quando o usu√°rio quiser ver a agenda:\n   - Use action: `list`\n   - Apresente os eventos de forma organizada\n\n**FORMATO DE DATAS:**\n- Sempre use ISO 8601 com timezone: `2025-12-01T14:00:00-03:00`\n- Timezone padr√£o: `America/Sao_Paulo`\n- Data atual para refer√™ncia: {{ new Date().toISOString() }}\n\n**IMPORTANTE:**\n- Nunca invente event_ids ‚Äî pe√ßa ao usu√°rio ou busque com `list`\n- Ap√≥s criar/atualizar/deletar, informe o resultado de forma amig√°vel\n- Se houver erro, explique de forma simples e ofere√ßa alternativas\n- Usu√°rio atual: {{ $('‚öôÔ∏è Preparar Input do Usu√°rio').item.json.user_name }}"
        }
      },
      "id": "ai-agent",
      "name": "ü§ñ AI Agent ‚Äî Assistente de Agendamento",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [500, 0]
    },
    {
      "parameters": {
        "content": "### ü§ñ AI AGENT ‚Äî CONFIGURA√á√ïES CR√çTICAS\n\n**Tipo:** Conversational Agent\n\n**LLM Recomendado:**\n- OpenAI GPT-4o (melhor function calling)\n- Anthropic Claude 3.5 Sonnet\n- Google Gemini 1.5 Pro\n\n**‚ö†Ô∏è CONECTAR NA PORTA `AI Model`:**\nO n√≥ `OpenAI Chat Model` deve ser conectado\nnesta entrada.\n\n**‚ö†Ô∏è CONECTAR NA PORTA `Memory`:**\nO n√≥ `Buffer Memory` deve ser conectado\npara manter contexto da conversa.\n\n**‚ö†Ô∏è CONECTAR NA PORTA `Tool`:**\nO n√≥ `Workflow Tool` deve ser conectado\naqui ‚Äî √© a ferramenta do Calendar.\n\n**System Prompt:** J√° configurado com\ninstru√ß√µes detalhadas de comportamento,\nregras de a√ß√£o e formato de datas.",
        "height": 300,
        "width": 320,
        "color": 4
      },
      "id": "comment-agent",
      "name": "Nota - AI Agent",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [500, -320]
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "temperature": 0.3,
          "maxTokens": 2000
        }
      },
      "id": "openai-model",
      "name": "üß† OpenAI GPT-4o",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [340, 220],
      "credentials": {
        "openAiApi": {
          "id": "openai-credential",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "content": "### üß† MODELO DE LINGUAGEM\n**Modelo:** GPT-4o\n**Temperature:** 0.3 (respostas mais precisas)\n**Max Tokens:** 2000\n\n**‚ö†Ô∏è Configurar credencial OpenAI:**\n1. Settings > Credentials\n2. OpenAI API\n3. Inserir API Key\n\n**Alternativa sem custo:** Use Ollama\ncom Llama 3 para testes locais.",
        "height": 180,
        "width": 270,
        "color": 3
      },
      "id": "comment-model",
      "name": "Nota - Modelo",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [340, 380]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('‚öôÔ∏è Preparar Input do Usu√°rio').item.json.session_id }}",
        "contextWindowLength": 10
      },
      "id": "buffer-memory",
      "name": "üíæ Buffer Memory ‚Äî Hist√≥rico",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [500, 220]
    },
    {
      "parameters": {
        "content": "### üíæ BUFFER MEMORY\n**Janela:** 10 mensagens (5 turnos)\n**Session Key:** `session_id` do usu√°rio\n\nMant√©m o contexto da conversa para que\no agente lembre do hist√≥rico recente.\n\n**Para mem√≥ria persistente (produ√ß√£o):**\nSubstitua por:\n- `Redis Memory` (mais r√°pido)\n- `Postgres Memory` (mais dur√°vel)\n- `Zep Memory` (com busca sem√¢ntica)\n\nA `session_id` garante que diferentes\nusu√°rios tenham mem√≥rias separadas.",
        "height": 210,
        "width": 290,
        "color": 5
      },
      "id": "comment-memory",
      "name": "Nota - Memory",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [500, 380]
    },
    {
      "parameters": {
        "source": "database",
        "workflowId": {
          "__rl": true,
          "value": "COLOQUE_O_ID_DO_WORKFLOW_TOOL_AQUI",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "passthrough"
        },
        "description": "Use esta ferramenta para gerenciar eventos no Google Calendar do usu√°rio.\n\nA√ß√µes dispon√≠veis (campo `action`):\n- `create`: Cria um novo evento\n- `read`: Busca detalhes de um evento pelo event_id\n- `update`: Atualiza um evento existente pelo event_id\n- `delete`: Remove um evento pelo event_id\n- `list`: Lista os pr√≥ximos 10 eventos futuros\n\nPar√¢metros por a√ß√£o:\n- CREATE: summary (obrigat√≥rio), start_time (obrigat√≥rio, ISO8601), end_time, description, attendees (emails separados por v√≠rgula), timezone\n- READ: event_id (obrigat√≥rio)\n- UPDATE: event_id (obrigat√≥rio) + campos a alterar\n- DELETE: event_id (obrigat√≥rio)\n- LIST: nenhum par√¢metro adicional obrigat√≥rio\n\nRetorna uma confirma√ß√£o em texto da opera√ß√£o realizada.",
        "name": "google_calendar_manager"
      },
      "id": "workflow-tool",
      "name": "üõ†Ô∏è Workflow Tool ‚Äî Calendar Manager",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [660, 220]
    },
    {
      "parameters": {
        "content": "### üõ†Ô∏è WORKFLOW TOOL ‚Äî CONFIGURA√á√ÉO CR√çTICA\n\n**‚ö†Ô∏è A√á√ÉO OBRIGAT√ìRIA:**\nSubstitua `COLOQUE_O_ID_DO_WORKFLOW_TOOL_AQUI`\npelo ID real do workflow tool de Calendar.\n\n**Como encontrar o ID:**\n1. Abra o workflow `üõ†Ô∏è TOOL ‚Äî Google Calendar`\n2. Veja a URL: `.../workflow/ESTE_NUMERO`\n3. Cole este n√∫mero aqui\n\n**Nome da tool:** `google_calendar_manager`\nEste nome √© usado pelo agente para\nidentificar e chamar a ferramenta.\n\n**Description:** Define EXATAMENTE o que\no LLM entende sobre a ferramenta.\nQuanto mais detalhada, melhor o desempenho.",
        "height": 270,
        "width": 310,
        "color": 1
      },
      "id": "comment-tool",
      "name": "Nota - Workflow Tool",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [660, 380]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "final_resp",
              "name": "response",
              "value": "={{ $json.output }}",
              "type": "string"
            },
            {
              "id": "sess_out",
              "name": "session_id",
              "value": "={{ $('‚öôÔ∏è Preparar Input do Usu√°rio').item.json.session_id }}",
              "type": "string"
            },
            {
              "id": "ts_out",
              "name": "timestamp",
              "value": "={{ new Date().toISOString() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "format-response",
      "name": "üì§ Formatar Resposta Final",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [780, 0]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": true, \"response\": $json.response, \"session_id\": $json.session_id, \"timestamp\": $json.timestamp } }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "webhook-response",
      "name": "üì® Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1020, 0]
    },
    {
      "parameters": {
        "content": "### üì® RESPOSTA AO WEBHOOK\n**Payload de retorno:**\n```json\n{\n  \"success\": true,\n  \"response\": \"Texto da resposta do agente\",\n  \"session_id\": \"user_123\",\n  \"timestamp\": \"2025-12-01T...\"\n}\n```\n\n**Para integrar com frontend:**\nLeia o campo `response` e exiba\npara o usu√°rio na interface.\n\n**‚ö†Ô∏è O campo `success: false` n√£o est√°\nimplementado aqui ‚Äî adicione um n√≥\nError Trigger para tratamento de erros.**",
        "height": 210,
        "width": 290,
        "color": 6
      },
      "id": "comment-response",
      "name": "Nota - Response",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [1020, -240]
    },
    {
      "parameters": {
        "content": "## üìå CHECKLIST DE CONFIGURA√á√ÉO\n\n### Antes de ativar os workflows:\n\n‚òê **1. Credenciais** cadastradas:\n   - [ ] Google Calendar OAuth2\n   - [ ] OpenAI API Key\n   - [ ] Supabase URL + Service Role Key\n\n‚òê **2. Supabase** ‚Äî tabela criada:\n   - [ ] Execute o SQL do n√≥ Supabase no painel\n   - [ ] Verifique que RLS est√° desabilitado ou configurado\n\n‚òê **3. Workflow Tool** ‚Äî atualizar ID:\n   - [ ] Copie o ID do workflow Tool\n   - [ ] Cole no n√≥ `üõ†Ô∏è Workflow Tool` deste agente\n\n‚òê **4. Testar fluxo completo:**\n   - [ ] POST: `{\"message\": \"liste meus eventos\"}`\n   - [ ] POST: `{\"message\": \"crie reuni√£o amanh√£ √†s 10h\"}`\n   - [ ] POST: `{\"message\": \"delete o evento [ID]\"}`\n\n‚òê **5. Seguran√ßa (produ√ß√£o):**\n   - [ ] Adicionar autentica√ß√£o no webhook\n   - [ ] Configurar HTTPS\n   - [ ] Limitar origens no CORS",
        "height": 380,
        "width": 380,
        "color": 2
      },
      "id": "comment-checklist",
      "name": "‚úÖ Checklist de Configura√ß√£o",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [1100, 300]
    }
  ],
  "connections": {
    "üåê Webhook ‚Äî Entrada": {
      "main": [[{ "node": "‚öôÔ∏è Preparar Input do Usu√°rio", "type": "main", "index": 0 }]]
    },
    "‚öôÔ∏è Preparar Input do Usu√°rio": {
      "main": [[{ "node": "ü§ñ AI Agent ‚Äî Assistente de Agendamento", "type": "main", "index": 0 }]]
    },
    "ü§ñ AI Agent ‚Äî Assistente de Agendamento": {
      "main": [[{ "node": "üì§ Formatar Resposta Final", "type": "main", "index": 0 }]]
    },
    "üì§ Formatar Resposta Final": {
      "main": [[{ "node": "üì® Webhook Response", "type": "main", "index": 0 }]]
    },
    "üß† OpenAI GPT-4o": {
      "ai_languageModel": [[{ "node": "ü§ñ AI Agent ‚Äî Assistente de Agendamento", "type": "ai_languageModel", "index": 0 }]]
    },
    "üíæ Buffer Memory ‚Äî Hist√≥rico": {
      "ai_memory": [[{ "node": "ü§ñ AI Agent ‚Äî Assistente de Agendamento", "type": "ai_memory", "index": 0 }]]
    },
    "üõ†Ô∏è Workflow Tool ‚Äî Calendar Manager": {
      "ai_tool": [[{ "node": "ü§ñ AI Agent ‚Äî Assistente de Agendamento", "type": "ai_tool", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": false,
    "n8nVersion": "2.8.3"
  },
  "pinData": {},
  "versionId": "agent-gcal-v1",
  "tags": [
    { "name": "AI Agent" },
    { "name": "Google Calendar" },
    { "name": "Supabase" },
    { "name": "Agendamento" }
  ]
}
